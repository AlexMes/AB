<?php

namespace App\Console\Commands\Reports;

use App\Lead;
use App\Offer;
use Illuminate\Console\Command;
use Illuminate\Support\Str;

class DetectDagestan extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'report:dagestan';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description';

    /**
     * Execute the console command.
     *
     * @return int
     */
    public function handle()
    {
        $leads = Lead::whereNotNull('offer_id')->whereBetween('created_at', ['2021-08-01 00:00:00','2021-08-10 23:59:59'])
            ->whereIn('offer_id', Offer::where('vertical', 'Crypt')->pluck('id'))
            ->cursor();

        $lowernames = collect($this->names())->map(fn ($item) => Str::lower($item));

        $dagestans = collect();

        foreach ($leads as $lead) {
            if (Str::contains($lead->fullname, $lowernames->toArray())) {
                $dagestans->add($lead);
            }
        }

        $this->table(['Day','Count', 'Dagestan','Dagestan,%'], $dagestans->groupBy(fn ($item) => $item->created_at->format('Y-m-d'))
            ->map(fn ($group, $key) => [
                $key,
                Lead::whereDate('created_at', $key)
                    ->whereIn('offer_id', Offer::where('vertical', 'Crypt')->pluck('id'))
                    ->valid()
                    ->count(),
                count($group),
                percentage(count($group), Lead::whereDate('created_at', $key)
                    ->whereIn('offer_id', Offer::where('vertical', 'Crypt')->pluck('id'))
                    ->valid()
                    ->count())
            ]));

        $this->info($dagestans->pluck('id')->implode(','));

        return 0;
    }


    protected function names()
    {
        return [
            'Абида',
            'Агабича',
            'Агабаджи',
            'Адавия',
            'Адиля',
            'Адина',
            'Азада',
            'Азиза',
            'Азима',
            'Айбала',
            'Аймесей',
            'Айша',
            'Айна',
            'Алима',
            'Алия',
            'Алма',
            'Алмагуль',
            'Алмаз',
            'Амина',
            'Ана',
            'Аниса',
            'Арам',
            'Арифа',
            'Арувджан',
            'Арувкыз',
            'Асият',
            'Атикат',
            'Афисат',
            'Афият',
            'Ашраф',
            'Альбина',
            'Багдагуль',
            'Бадан',
            'Байза',
            'Балакыз',
            'Бани',
            'Барият',
            'Басират',
            'Бахарай',
            'Белла',
            'Беневша',
            'Биби',
            'Бике',
            'Боранбийке',
            'Буният',
            'Бустан',
            'Бурлият',
            'Вагидат',
            'Вазипат',
            'Валида',
            'Важибат',
            'Гавхар',
            'Ганифат',
            'Гелин',
            'Генже',
            'Гезель',
            'Гегурчун',
            'Гуварша',
            'Гулькыз',
            'Гульнара',
            'Гульзар',
            'Гульджан',
            'Гулистан',
            'Гулаба',
            'Гури',
            'Гузгю',
            'Гульзахра',
            'Гульдженнет',
            'Гульмира',
            'Гульназ',
            'Гульпери',
            'Дагират',
            'Джавгарат',
            'Джамила',
            'Джаннат',
            'Джахан',
            'Джанисат',
            'Джейран',
            'Джума',
            'Диляра',
            'Динара',
            'Дурия',
            'Жасмина',
            'Загидат',
            'Заира',
            'Зайнаб',
            'Залина',
            'Замира',
            'Зарема',
            'Зари',
            'Зарифа',
            'Захра',
            'Зиярат',
            'Зубайда',
            'Зулайха',
            'Зульфия',
            'Зумруд',
            'Зури',
            'Зухра',
            'Изафар',
            'Издег',
            'Кабират',
            'Кадрия',
            'Камила',
            'Карима',
            'Кюбре',
            'Лала',
            'Лейла',
            'Мадина',
            'Маида',
            'Майсарат',
            'Мазифат',
            'Малика',
            'Марджанат',
            'Марзия',
            'Марина',
            'Меседу',
            'Мина',
            'Минай',
            'Мугубат',
            'Муслима',
            'Муминат',
            'Пакизат',
            'Пари',
            'Паризад',
            'Пирдавус',
            'Рагимат',
            'Разият',
            'Раисат',
            'Расима',
            'Рашидат',
            'Сабира',
            'Саида',
            'Саимат',
            'Сакинат',
            'Саламат',
            'Салима',
            'Салихат',
            'Салтанат',
            'Самира',
            'Сапира',
            'Сапият',
            'Сара',
            'Сарыкиз',
            'Сима',
            'Сона',
            'Суюн',
            'Таибат',
            'Толганай',
            'Тоту',
            'Узум',
            'Умужат',
            'Унайзат',
            'Устанай',
            'Фазилат',
            'Фаиза',
            'Фарида',
            'Фатима',
            'Фируза',
            'Фирдаус',
            'Чиниг',
            'Шамай',
            'Шамсият',
            'Шекер',
            'Шерифа',
            'Шуше',
            'Эйлиханум',
            'Эльвира',
            'Юлдуз',
            'Якунт',
            'Абди',
            'Абдулла',
            'Абдул',
            'Абдулазиз',
            'Абдулазим',
            'Абдулбари',
            'Абдуллабек',
            'Абдулвали',
            'Абдулварис',
            'Абдулвахид',
            'Абдулваххаб',
            'Абдулгани',
            'Абдулгафур',
            'Абдулгамид',
            'Абдулжалил',
            'Абдулжамал',
            'Абдулджабар',
            'Абдулкерим',
            'Абдулкадыр',
            'Абдуллатиф',
            'Абдулмеджид',
            'Абдулмалик',
            'Абдулмуслим',
            'Абдулфаттах',
            'Абдулхаким',
            'Абдулхалик',
            'Абдулхалим',
            'Абдулхамид',
            'Абдурагим',
            'Абдурахман',
            'Абдуразак',
            'Абдурашид',
            'Абдусалам',
            'Абдусалим',
            'Абдусамад',
            'Абид',
            'Абузар',
            'Абумуслим',
            'Абук',
            'Абубакар',
            'Абусаид',
            'Абуталиб',
            'Аваз',
            'Ага',
            'Агаси',
            'Агабек',
            'Агахан',
            'Агададаш',
            'Адил',
            'Адильгирей',
            'Адилхан',
            'Азад',
            'Азамат',
            'Азар',
            'Азиз',
            'Азим',
            'Айдемир',
            'Айдун',
            'Ай',
            'Айнуддин',
            'Ак',
            'Акбар',
            'Акил',
            'Акиф',
            'Алам',
            'Алауддин',
            'Али',
            'Алиаббас',
            'Алибайрам',
            'Алиакбар',
            'Алиаскар',
            'Алим',
            'Алибек',
            'Алибулат',
            'Алигаджи',
            'Алигайдар',
            'Алимпаша',
            'Алиф',
            'Алишер',
            'Алияр',
            'Алхас',
            'Алтын',
            'Амид',
            'Амин',
            'Амир',
            'Амирали',
            'Анас',
            'Анвар',
            'Анварали',
            'Ансар',
            'Арафат',
            'Аргун',
            'Арип',
            'Арзу',
            'Арсен',
            'Арслан',
            'Арслангерей',
            'Аршак',
            'Ардаш',
            'Асад',
            'Асадулла',
            'Аса',
            'Аслам',
            'Аслуддин',
            'Асельдар',
            'Ата',
            'Атабай',
            'Атабек',
            'Атанас',
            'Атаман',
            'Аттар',
            'Атлу',
            'Атсыз',
            'Ахалав',
            'Ахмад',
            'Ахунд',
            'Ахсан',
            'Ашик',
            'Ашраф',
            'Ашуг',
            'Аюб',
            'Бабаджан',
            'Бабак',
            'Баганд',
            'Багаутдин',
            'Багдасар',
            'Багир',
            'Бадих',
            'Бадруддин',
            'Базарган',
            'Бай',
            'Байрам',
            'Байсунгур',
            'Байтаза',
            'Барзулав',
            'Барцу',
            'Басир',
            'Бахрам',
            'Бахтияр',
            'Бахти',
            'Башир',
            'Бек',
            'Бек',
            'Бекбулат',
            'Бекмурад',
            'Бейбут',
            'Бекташ',
            'Берди',
            'Билал',
            'Бульбуль',
            'Бурхан',
            'Бустан',
            'Бута',
            'Вагаб',
            'Вагид',
            'Вагиф',
            'Вазир',
            'Вазиф',
            'Вакил',
            'Вакиф',
            'Вали',
            'Валид',
            'Варис',
            'Ваххаб',
            'Гаджи',
            'Гази',
            'Галиб',
            'Гамид',
            'Ганипа',
            'Гапур',
            'Гарун',
            'Гафур',
            'Гаффар',
            'Гирей',
            'Гитин',
            'Гитинавас',
            'Голохан',
            'Гудул',
            'Гулла',
            'Гусейн',
            'Дамада',
            'Дарвиш',
            'Дауд',
            'Девлетхан',
            'Джаббар',
            'Джабир',
            'Джабраил',
            'Джавад',
            'Джалал',
            'Джамалутдин',
            'Джалил',
            'Джамал',
            'Джамил',
            'Джан',
            'Джангиши',
            'Джамбулат',
            'Джигит',
            'Джумали',
            'Дибир',
            'Забит',
            'Загид',
            'Заид',
            'Загир',
            'Зайдулла',
            'Зайнал',
            'Зайнулла',
            'Зайналабид',
            'Зайнутдин',
            'Закир',
            'Залим',
            'Заман',
            'Замир',
            'Зариф',
            'Заур',
            'Зафар',
            'Зикрулла',
            'Зинатулла',
            'Зубаир',
            'Зубаид',
            'Зубайдулла',
            'Зулал',
            'Зулкарнай',
            'Ибад',
            'Ибрахим',
            'Идрис',
            'Иззат',
            'Иззутдин',
            'Икрам',
            'Ильяс',
            'Имам',
            'Имамутдин',
            'Иман',
            'Имран',
            'Инал',
            'Инам',
            'Иршад',
            'Иса',
            'Исакули',
            'Исалутдин',
            'Искандар',
            'Ислам',
            'Исламбек',
            'Исмаил',
            'Исмат',
            'Исматулла',
            'Исхак',
            'Ихлас',
            'Кабил',
            'Кабир',
            'Кагир',
            'Кади',
            'Кадир',
            'Казбек',
            'Казим',
            'Казимали',
            'Казимбек',
            'Казихан',
            'Каир',
            'Калантар',
            'Калсын',
            'Камер',
            'Камал',
            'Камалутдин',
            'Камил',
            'Канбар',
            'Кара',
            'Карабатыр',
            'Карабек',
            'Карам',
            'Кари',
            'Карим',
            'Каримулла',
            'Касим',
            'Кафур',
            'Кахраман',
            'Кичи',
            'Клыч',
            'Кудрат',
            'Кумуш',
            'Курайш',
            'Курбан',
            'Курбанали',
            'Коркмас',
            'Кухмаз',
            'Лачин',
            'Лукман',
            'Лутфи',
            'Магад',
            'Магарам',
            'Магидин',
            'Магуш',
            'Маджид',
            'Маджнун',
            'Мазхар',
            'Маймун',
            'Максуд',
            'Максум',
            'Малик',
            'Малла',
            'Манур',
            'Марван',
            'Мардан',
            'Маруф',
            'Маслама',
            'Масум',
            'Махди',
            'Мисри',
            'Митхад',
            'Мубарак',
            'Муршид',
            'Мустафа',
            'Муса',
            'Муслим',
            'Муталиб',
            'Муталим',
            'Муъмин',
            'Мухаммад',
            'Мухаммадазиз',
            'Мухаммадазим',
            'Мухаммадамин',
            'Мухаммадвали',
            'Мухаммадариф',
            'Мухаммадгази',
            'Мухаммадгафур',
            'Мухаммадкамиль',
            'Мухаммадкарим',
            'Мухаммадмасул',
            'Мухаммадлатиф',
            'Мухаммадмуьмин',
            'Мухаммадрасул',
            'Мужаммадрахим',
            'Мухаммадриза',
            'Мухаммадсадык',
            'Мухаммадсаид',
            'Мухаммадсайид',
            'Мухаммадсалих',
            'Мухаммадтайиб',
            'Мухаммадтахир',
            'Мухтар',
            'Муху',
            'Наби',
            'Навруз',
            'Надин',
            'Надиршах',
            'Нажмуддин',
            'Назар',
            'Назарали',
            'Назарбек',
            'Назим',
            'Назир',
            'Назиф',
            'Назирхан',
            'Наиб',
            'Наиль',
            'Нариман',
            'Насим',
            'Насир',
            'Наср',
            'Насреддин',
            'Насрулла',
            'Низам',
            'Низамутдин',
            'Ниматулла',
            'Нияз',
            'Нукер',
            'Hyp',
            'Нурислам',
            'Нурулла',
            'Нурутдин',
            'Ольмес',
            'Омар',
            'Оразай',
            'Осман',
            'Пайзутдин',
            'Пача',
            'Пир',
            'Порсук',
            'Раджаб',
            'Раззак',
            'Рамадан',
            'Рамиз',
            'Рамидин',
            'Рамихан',
            'Расим',
            'Расул',
            'Раруф',
            'Рафик',
            'Рахим',
            'Рахман',
            'Рахмат',
            'Рахматулла',
            'Ризван',
            'Рустам',
            'Саади',
            'Сабир',
            'Сабит',
            'Сабур',
            'Садик',
            'Садрудднн',
            'Садулла',
            'Саид',
            'Саидмурад',
            'Сайфутдин',
            'Сайфулла',
            'Салават',
            'Салам',
            'Саламат',
            'Салах',
            'Салим',
            'Салих',
            'Салман',
            'Самад',
            'Самир',
            'Самур',
            'Сарда',
            'Сафиюлла',
            'Сахават',
            'Сахр',
            'Сиявуш',
            'Султан',
            'Суюм',
            'Тагир',
            'Таджеддин',
            'Тайгиб',
            'Тауфик',
            'Таштемир',
            'Темирбек',
            'Темур',
            'Тофик',
            'Тулпар',
            'Турсун',
            'Убайдулла',
            'Увайс',
            'Уллубий',
            'Улуг',
            'Улугбек',
            'Умар',
            'Усман',
            'Уста',
            'Устад',
            'Фазил',
            'Файзутдин',
            'Файзулла',
            'Фарид',
            'Фархад',
            'Фархат',
            'Фаттах',
            'Фатали',
            'Фатхулла',
            'Фикрет',
            'Хабиб',
            'Хабибуддин',
            'Хабибулла',
            'Хабир',
            'Хадж',
            'Хадис',
            'Хазар',
            'Хазрат',
            'Хайдар',
            'Хайрутдин',
            'Хайрулла',
            'Хакам',
            'Хаким',
            'Халид',
            'Халик',
            'Халил',
            'Халим',
            'Хамза',
            'Хамид',
            'Хас',
            'Хасан',
            'Хафиз',
            'Хашим',
            'Хуршид',
            'Хусайн',
            'Цевехан',
            'Челеби',
            'Чингиз',
            'Чингизхан',
            'Чупан',
            'Шакир',
            'Шакур',
            'Шамсутдин',
            'Шамсулла',
            'Шамшир',
            'Шафи',
            'Шахбаз',
            'Шахид',
            'Шахмардан',
            'Шахнаваз',
            'Шахназар',
            'Шахсавар',
            'Шейх',
            'Шир',
            'Шихабутдин',
            'Шуайб',
            'Эльдар',
            'Эльмурад',
            'Эрджигит',
            'Юлдаш',
            'Юнус',
            'Юсуф',
            'Яваш',
            'Ядгар',
            'Язид',
            'Якуб',
            'Якут',
            'Ярали',
            'Яра'
        ];
    }
}
